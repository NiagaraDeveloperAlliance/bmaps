define("hbs!nmodule/bmaps/rc/BMapsWidgetTemplate",["Handlebars"],function(g){var l=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,b,c,h,d){return'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\x3chead\x3e\n    \x3cmeta http-equiv\x3d"Content-Type" content\x3d"text/html; charset\x3dutf-8"/\x3e\n    \x3cmeta name\x3d"viewport" content\x3d"initial-scale\x3d1.0, user-scalable\x3dno"/\x3e\n    \x3cstyle type\x3d"text/css"\x3e\n        body, html, #container {\n            width: 100%;\n            height: 100%;\n            overflow: hidden;\n            margin: 0;\n            font-family: Arial, Helvetica, "Microsoft YaHei", sans-serif;\n        }\n    \x3c/style\x3e\n    \x3ctitle\x3e\u5730\u56fe\u5c55\u793a\x3c/title\x3e\n\x3c/head\x3e\n\x3cbody\x3e\n    \n\x3cdiv id\x3d"container"\x3e\x3c/div\x3e\n\x3cdiv id\x3d"search-list" class\x3d"search-list"\x3e\n    \x3cinput type\x3d"text" class\x3d"search" id\x3d"suggestId" placeholder\x3d"Search..." autocomplete\x3d"off"/\x3e\n    \x3cdiv class\x3d"list" style\x3d"display: none;" \x3e\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv style\x3d"display:none;"\x3e\n  \x3c!-- A template element is needed when list is empty, TODO: needs a better solution --\x3e\n  \x3cspan id\x3d"search-item"\x3e\n  \x3ch3 class\x3d"title btn"\x3e\x3c/h3\x3e\n  \x3c/span\x3e\n\x3c/div\x3e\n\x3c/body\x3e\n\x3c/html\x3e\n'},
useData:!0});g.registerPartial("nmodule/bmaps/rc/BMapsWidgetTemplate",l);return l});
define("hbs!nmodule/bmaps/rc/PopupTemplate",["Handlebars"],function(g){var l=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,b,c,h,d){var e,k;return(null!=(e=c["if"].call(null!=b?b:{},null!=b?b.imageSrc:b,{name:"if",hash:{},fn:a.program(1,d,0),inverse:a.noop,data:d}))?e:"")+(null!=(e=c["if"].call(null!=b?b:{},null!=b?b.description:b,{name:"if",hash:{},fn:a.program(3,d,0),inverse:a.noop,data:d}))?e:"")+'\x3cdiv class\x3d"popup-alarm-count"\x3e'+a.escapeExpression((k=null!=(k=c.alarmCount||
(null!=b?b.alarmCount:b))?k:c.helperMissing,"function"===typeof k?k.call(null!=b?b:{},{name:"alarmCount",hash:{},data:d}):k))+' Alarms\x3c/div\x3e\n\x3cdiv class\x3d"info-window-props-container"\x3e\n  \x3ctable class\x3d"table table-bordered"\x3e\x3ctbody\x3e\n'+(null!=(e=c["if"].call(null!=b?b:{},null!=b?b.rows:b,{name:"if",hash:{},fn:a.program(5,d,0),inverse:a.noop,data:d}))?e:"")+"  \x3c/tbody\x3e\x3c/table\x3e\n\x3c/div\x3e\n"},1:function(a,b,c,h,d){var e;return'\x3cdiv class\x3d"popup-image"\x3e\x3cimg src\x3d'+
a.escapeExpression((e=null!=(e=c.imageSrc||(null!=b?b.imageSrc:b))?e:c.helperMissing,"function"===typeof e?e.call(null!=b?b:{},{name:"imageSrc",hash:{},data:d}):e))+"\x3e\x3c/div\x3e\n"},3:function(a,b,c,h,d){var e;return'\x3cdiv class\x3d"popup-description"\x3e'+a.escapeExpression((e=null!=(e=c.description||(null!=b?b.description:b))?e:c.helperMissing,"function"===typeof e?e.call(null!=b?b:{},{name:"description",hash:{},data:d}):e))+"\x3c/div\x3e\n"},5:function(a,b,c,h,d){var e;return null!=(e=c.each.call(null!=
b?b:{},null!=b?b.rows:b,{name:"each",hash:{},fn:a.program(6,d,0),inverse:a.noop,data:d}))?e:""},6:function(a,b,c,h,d){var e,k;return"      \x3ctr\x3e\n       \x3ctd\x3e"+a.escapeExpression((k=null!=(k=c.displayName||(null!=b?b.displayName:b))?k:c.helperMissing,"function"===typeof k?k.call(null!=b?b:{},{name:"displayName",hash:{},data:d}):k))+"\x3c/td\x3e\n       \x3ctd\x3e\n        "+a.escapeExpression((k=null!=(k=c.value||(null!=b?b.value:b))?k:c.helperMissing,"function"===typeof k?k.call(null!=
b?b:{},{name:"value",hash:{},data:d}):k))+"\n"+(null!=(e=c["if"].call(null!=b?b:{},null!=b?b.alarm:b,{name:"if",hash:{},fn:a.program(7,d,0),inverse:a.noop,data:d}))?e:"")+"       \x3c/td\x3e\n      \x3c/tr\x3e\n"},7:function(a,b,c,h,d){return'        \x3cspan class\x3d"alarm-text"\x3ealarm\x3c/span\x3e\n'},useData:!0});g.registerPartial("nmodule/bmaps/rc/PopupTemplate",l);return l});
var List=function(g){function l(b){if(a[b])return a[b].exports;var c=a[b]={i:b,l:!1,exports:{}};return g[b].call(c.exports,c,c.exports,l),c.l=!0,c.exports}var a={};return l.m=g,l.c=a,l.i=function(a){return a},l.d=function(a,c,h){l.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:h})},l.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return l.d(c,"a",c),c},l.o=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)},l.p="",l(l.s=11)}([function(g,
l,a){function b(a){if(!a||!a.nodeType)throw Error("A DOM element reference is required");this.el=a;this.list=a.classList}var c=a(4),h=/\s+/;Object.prototype.toString;g.exports=function(a){return new b(a)};b.prototype.add=function(a){if(this.list)return this.list.add(a),this;var b=this.array();return~c(b,a)||b.push(a),this.el.className=b.join(" "),this};b.prototype.remove=function(a){if(this.list)return this.list.remove(a),this;var b=this.array();a=c(b,a);return~a&&b.splice(a,1),this.el.className=
b.join(" "),this};b.prototype.toggle=function(a,b){return this.list?("undefined"!=typeof b?b!==this.list.toggle(a,b)&&this.list.toggle(a):this.list.toggle(a),this):("undefined"!=typeof b?b?this.add(a):this.remove(a):this.has(a)?this.remove(a):this.add(a),this)};b.prototype.array=function(){var a=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(h);return""===a[0]&&a.shift(),a};b.prototype.has=b.prototype.contains=function(a){return this.list?this.list.contains(a):!!~c(this.array(),
a)}},function(g,l,a){var b=window.addEventListener?"addEventListener":"attachEvent",c=window.removeEventListener?"removeEventListener":"detachEvent",h="addEventListener"!==b?"on":"",d=a(5);l.bind=function(a,k,c,p){a=d(a);for(var m=0;m<a.length;m++)a[m][b](h+k,c,p||!1)};l.unbind=function(a,b,q,p){a=d(a);for(var m=0;m<a.length;m++)a[m][c](h+b,q,p||!1)}},function(g,l){g.exports=function(a){return function(b,c,h){var d=this;this._values={};this.filtered=this.found=!1;this.values=function(b,k){if(void 0===
b)return d._values;for(var c in b)d._values[c]=b[c];!0!==k&&a.templater.set(d,d.values())};this.show=function(){a.templater.show(d)};this.hide=function(){a.templater.hide(d)};this.matching=function(){return a.filtered&&a.searched&&d.found&&d.filtered||a.filtered&&!a.searched&&d.filtered||!a.filtered&&a.searched&&d.found||!a.filtered&&!a.searched};this.visible=function(){return!(!d.elm||d.elm.parentNode!=a.list)};(function(b,k,c){void 0===k?c?d.values(b,c):d.values(b):(d.elm=k,b=a.templater.get(d,
b),d.values(b))})(b,c,h)}}},function(g,l){g.exports=function(){return function(a,b,c,h){h=h||{};if(h.test&&h.getElementsByClassName||!h.test&&document.getElementsByClassName)c=c?a.getElementsByClassName(b)[0]:a.getElementsByClassName(b);else if(h.test&&h.querySelector||!h.test&&document.querySelector)h=b,c=(h="."+h,c?a.querySelector(h):a.querySelectorAll(h));else a:{h=[];a=a.getElementsByTagName("*");var d=a.length;b=RegExp("(^|\\s)"+b+"(\\s|$)");for(var e=0,k=0;e<d;e++)if(b.test(a[e].className)){if(c){c=
a[e];break a}h[k]=a[e];k++}c=h}return c}}()},function(g,l){var a=[].indexOf;g.exports=function(b,c){if(a)return b.indexOf(c);for(var h=0;h<b.length;++h)if(b[h]===c)return h;return-1}},function(g,l){g.exports=function(a){if("undefined"==typeof a)return[];if(null===a)return[null];if(a===window)return[window];if("string"==typeof a)return[a];if("[object Array]"===Object.prototype.toString.call(a))return a;if("number"!=typeof a.length||"function"==typeof a&&a instanceof Function)return[a];for(var b=[],
c=0;c<a.length;c++)(Object.prototype.hasOwnProperty.call(a,c)||c in a)&&b.push(a[c]);return b.length?b:[]}},function(g,l){g.exports=function(a){return a=void 0===a?"":a,a=null===a?"":a,a.toString()}},function(g,l){g.exports=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),h=0;b=c[h];h++)if(b)for(var d in b)a[d]=b[d];return a}},function(g,l){g.exports=function(a){var b=function(c,h,d){var e=c.splice(0,50);d=d||[];d=d.concat(a.add(e));0<c.length?setTimeout(function(){b(c,h,d)},1):(a.update(),
h(d))};return b}},function(g,l){g.exports=function(a){return a.handlers.filterStart=a.handlers.filterStart||[],a.handlers.filterComplete=a.handlers.filterComplete||[],function(b){if(a.trigger("filterStart"),a.i=1,a.reset.filter(),void 0===b)a.filtered=!1;else{a.filtered=!0;for(var c=a.items,h=0,d=c.length;h<d;h++){var e=c[h];b(e)?e.filtered=!0:e.filtered=!1}}return a.update(),a.trigger("filterComplete"),a.visibleItems}}},function(g,l,a){var b=(a(0),a(1)),c=a(7),h=a(6),d=a(3),e=a(19);g.exports=function(a,
q){q=q||{};q=c({location:0,distance:100,threshold:0.4,multiSearch:!0,searchClass:"fuzzy-search"},q);var p={search:function(b,d){for(var e=q.multiSearch?b.replace(/ +$/,"").split(/ +/):[b],c=0,f=a.items.length;c<f;c++)p.item(a.items[c],d,e)},item:function(a,b,d){for(var e=!0,f=0;f<d.length;f++){for(var c=!1,k=0,h=b.length;k<h;k++)p.values(a.values(),b[k],d[f])&&(c=!0);c||(e=!1)}a.found=e},values:function(a,b,d){return a.hasOwnProperty(b)&&(a=h(a[b]).toLowerCase(),e(a,d,q))?!0:!1}};return b.bind(d(a.listContainer,
q.searchClass),"keyup",function(b){a.search((b.target||b.srcElement).value,p.search)}),function(b,d){a.search(b,d,p.search)}}},function(g,l,a){var b=a(18),c=a(3),h=a(7),d=a(4),e=a(1),k=a(6),q=a(0),p=a(17),m=a(5);g.exports=function(r,g,l){var f=this,n=a(2)(f),u=a(8)(f),y=a(12)(f);this.reIndex=function(){f.items=[];f.visibleItems=[];f.matchingItems=[];f.searched=!1;f.filtered=!1;f.parse(f.list)};this.toJSON=function(){for(var a=[],b=0,d=f.items.length;b<d;b++)a.push(f.items[b].values());return a};this.add=
function(a,b){if(0!==a.length){if(b)return void u(a,b);var d=[],e=!1;void 0===a[0]&&(a=[a]);for(var c=0,p=a.length;c<p;c++)e=null,e=f.items.length>f.page,e=new n(a[c],void 0,e),f.items.push(e),d.push(e);return f.update(),d}};this.show=function(a,b){return this.i=a,this.page=b,f.update(),f};this.remove=function(a,b,d){for(var e=0,c=0,p=f.items.length;c<p;c++)f.items[c].values()[a]==b&&(f.templater.remove(f.items[c],d),f.items.splice(c,1),p--,c--,e++);return f.update(),e};this.get=function(a,b){for(var d=
[],e=0,c=f.items.length;e<c;e++){var p=f.items[e];p.values()[a]==b&&d.push(p)}return d};this.size=function(){return f.items.length};this.clear=function(){return f.templater.clear(),f.items=[],f};this.on=function(a,b){return f.handlers[a].push(b),f};this.off=function(a,b){var e=f.handlers[a],c=d(e,b);return-1<c&&e.splice(c,1),f};this.trigger=function(a){for(var b=f.handlers[a].length;b--;)f.handlers[a][b](f);return f};this.reset={filter:function(){for(var a=f.items,b=a.length;b--;)a[b].filtered=!1;
return f},search:function(){for(var a=f.items,b=a.length;b--;)a[b].found=!1;return f}};this.update=function(){var a=f.items,b=a.length;f.visibleItems=[];f.matchingItems=[];f.templater.clear();for(var d=0;d<b;d++)a[d].matching()&&f.matchingItems.length+1>=f.i&&f.visibleItems.length<f.page?(a[d].show(),f.visibleItems.push(a[d]),f.matchingItems.push(a[d])):a[d].matching()?(f.matchingItems.push(a[d]),a[d].hide()):a[d].hide();return f.trigger("updated"),f};({start:function(){f.listClass="list";f.searchClass=
"search";f.sortClass="sort";f.page=1E4;f.i=1;f.items=[];f.visibleItems=[];f.matchingItems=[];f.searched=!1;f.filtered=!1;f.searchColumns=void 0;f.handlers={updated:[]};f.valueNames=[];f.utils={getByClass:c,extend:h,indexOf:d,events:e,toString:k,naturalSort:b,classes:q,getAttribute:p,toArray:m};f.utils.extend(f,g);f.listContainer="string"==typeof r?document.getElementById(r):r;f.listContainer&&(f.list=c(f.listContainer,f.listClass,!0),f.parse=a(13)(f),f.templater=a(16)(f),f.search=a(14)(f),f.filter=
a(9)(f),f.sort=a(15)(f),f.fuzzySearch=a(10)(f,g.fuzzySearch),this.handlers(),this.items(),this.pagination(),f.update())},handlers:function(){for(var a in f.handlers)f[a]&&f.on(a,f[a])},items:function(){f.parse(f.list);void 0!==l&&f.add(l)},pagination:function(){if(void 0!==g.pagination){!0===g.pagination&&(g.pagination=[{}]);void 0===g.pagination[0]&&(g.pagination=[g.pagination]);for(var a=0,b=g.pagination.length;a<b;a++)y(g.pagination[a])}}}).start()}},function(g,l,a){var b=a(0),c=a(1),h=a(11);g.exports=
function(a){var e=function(e,c){var h,g=a.i,l=a.page,f=Math.ceil(a.matchingItems.length/l),g=Math.ceil(g/l),n=c.innerWindow||2,u=c.left||c.outerWindow||0,y=c.right||c.outerWindow||0,y=f-y;e.clear();for(var x=1;x<=f;x++){var G=g===x?"active":"";k.number(x,u,y,g,n)?(h=e.add({page:x,dotted:!1})[0],G&&b(h.elm).add(G),q(h.elm,x,l)):k.dotted(e,x,u,y,g,n,e.size())&&(h=e.add({page:"...",dotted:!0})[0],b(h.elm).add("disabled"))}},k={number:function(a,b,d,e,c){return this.left(a,b)||this.right(a,d)||this.innerWindow(a,
e,c)},left:function(a,b){return a<=b},right:function(a,b){return a>b},innerWindow:function(a,b,d){return a>=b-d&&a<=b+d},dotted:function(a,b,d,e,c,f,k){return this.dottedLeft(a,b,d,e,c,f)||this.dottedRight(a,b,d,e,c,f,k)},dottedLeft:function(a,b,d,e,c,f){return b==d+1&&!this.innerWindow(b,c,f)&&!this.right(b,e)},dottedRight:function(a,b,d,e,c,f,k){return!a.items[k-1].values().dotted&&b==e&&!this.innerWindow(b,c,f)&&!this.right(b,e)}},q=function(b,e,k){c.bind(b,"click",function(){a.show((e-1)*k+1,
k)})};return function(b){var c=new h(a.listContainer.id,{listClass:b.paginationClass||"pagination",item:"\x3cspan\x3e\x3ca class\x3d'page' href\x3d'javascript:function Z(){Z\x3d\"\"}Z()'\x3e\x3c/a\x3e\x3c/span\x3e",valueNames:["page","dotted"],searchClass:"pagination-search-that-is-not-supposed-to-exist",sortClass:"pagination-sort-that-is-not-supposed-to-exist"});a.on("updated",function(){e(c,b)});e(c,b)}}},function(g,l,a){g.exports=function(b){var c=a(2)(b),h=function(a,d){for(var h=0,p=a.length;h<
p;h++)b.items.push(new c(d,a[h]))},d=function(a,c){var q=a.splice(0,50);h(q,c);0<a.length?setTimeout(function(){d(a,c)},1):(b.update(),b.trigger("parseComplete"))};return b.handlers.parseComplete=b.handlers.parseComplete||[],function(){for(var a=b.list.childNodes,c=[],q=0,p=a.length;q<p;q++)void 0===a[q].data&&c.push(a[q]);a=b.valueNames;b.indexAsync?d(c,a):h(c,a)}}},function(g,l){g.exports=function(a){var b,c,h,d,e={resetList:function(){a.i=1;a.templater.clear();d=void 0},setOptions:function(a){2==
a.length&&a[1]instanceof Array?c=a[1]:2==a.length&&"function"==typeof a[1]?(c=void 0,d=a[1]):3==a.length?(c=a[1],d=a[2]):c=void 0},setColumns:function(){0!==a.items.length&&void 0===c&&(c=void 0===a.searchColumns?e.toArray(a.items[0].values()):a.searchColumns)},setSearchString:function(b){b=a.utils.toString(b).toLowerCase();h=b=b.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$\x26")},toArray:function(a){var b=[],d;for(d in a)b.push(d);return b}},k={list:function(){for(var b=0,d=a.items.length;b<d;b++)k.item(a.items[b])},
item:function(a){a.found=!1;for(var b=0,d=c.length;b<d;b++)if(k.values(a.values(),c[b]))return void(a.found=!0)},values:function(d,c){return!(!d.hasOwnProperty(c)||!(b=a.utils.toString(d[c]).toLowerCase(),""!==h&&-1<b.search(h)))},reset:function(){a.reset.search();a.searched=!1}},q=function(b){return a.trigger("searchStart"),e.resetList(),e.setSearchString(b),e.setOptions(arguments),e.setColumns(),""===h?k.reset():(a.searched=!0,d?d(h,c):k.list()),a.update(),a.trigger("searchComplete"),a.visibleItems};
return a.handlers.searchStart=a.handlers.searchStart||[],a.handlers.searchComplete=a.handlers.searchComplete||[],a.utils.events.bind(a.utils.getByClass(a.listContainer,a.searchClass),"keyup",function(b){b=b.target||b.srcElement;""===b.value&&!a.searched||q(b.value)}),a.utils.events.bind(a.utils.getByClass(a.listContainer,a.searchClass),"input",function(a){""===(a.target||a.srcElement).value&&q("")}),q}},function(g,l){g.exports=function(a){var b={els:void 0,clear:function(){for(var c=0,d=b.els.length;c<
d;c++)a.utils.classes(b.els[c]).remove("asc"),a.utils.classes(b.els[c]).remove("desc")},getOrder:function(b){var d=a.utils.getAttribute(b,"data-order");return"asc"==d||"desc"==d?d:a.utils.classes(b).has("desc")?"asc":a.utils.classes(b).has("asc")?"desc":"asc"},getInSensitive:function(b,d){"false"===a.utils.getAttribute(b,"data-insensitive")?d.insensitive=!1:d.insensitive=!0},setOrder:function(c){for(var d=0,e=b.els.length;d<e;d++){var k=b.els[d];if(a.utils.getAttribute(k,"data-sort")===c.valueName){var q=
a.utils.getAttribute(k,"data-order");"asc"==q||"desc"==q?q==c.order&&a.utils.classes(k).add(c.order):a.utils.classes(k).add(c.order)}}}},c=function(c,d){a.trigger("sortStart");var e={},k=c.currentTarget||c.srcElement||void 0;k?(e.valueName=a.utils.getAttribute(k,"data-sort"),b.getInSensitive(k,e),e.order=b.getOrder(k)):(e=d||e,e.valueName=c,e.order=e.order||"asc",e.insensitive="undefined"==typeof e.insensitive||e.insensitive);b.clear();b.setOrder(e);var q=e.sortFunction||a.sortFunction||null,g="desc"===
e.order?-1:1;a.items.sort(q?function(a,b){return q(a,b,e)*g}:function(b,d){var c=a.utils.naturalSort;return c.alphabet=a.alphabet||e.alphabet||void 0,!c.alphabet&&e.insensitive&&(c=a.utils.naturalSort.caseInsensitive),c(b.values()[e.valueName],d.values()[e.valueName])*g});a.update();a.trigger("sortComplete")};return a.handlers.sortStart=a.handlers.sortStart||[],a.handlers.sortComplete=a.handlers.sortComplete||[],b.els=a.utils.getByClass(a.listContainer,a.sortClass),a.utils.events.bind(b.els,"click",
c),a.on("searchStart",b.clear),a.on("filterStart",b.clear),c}},function(g,l){var a=function(a){var c,h=this;this.clearSourceItem=function(d,c){for(var k=0,h=c.length;k<h;k++){var g;if(c[k].data){g=0;for(var m=c[k].data.length;g<m;g++)d.setAttribute("data-"+c[k].data[g],"")}else c[k].attr&&c[k].name?(g=a.utils.getByClass(d,c[k].name,!0),g&&g.setAttribute(c[k].attr,"")):(g=a.utils.getByClass(d,c[k],!0),g&&(g.innerHTML=""));g=void 0}return d};this.getItemSource=function(d){if(void 0===d){d=a.list.childNodes;
for(var c=0,k=d.length;c<k;c++)if(void 0===d[c].data)return d[c].cloneNode(!0)}else{if(/<tr[\s>]/g.exec(d))return c=document.createElement("tbody"),c.innerHTML=d,c.firstChild;if(-1!==d.indexOf("\x3c"))return c=document.createElement("div"),c.innerHTML=d,c.firstChild;if(d=document.getElementById(a.item))return d}};this.get=function(c,e){h.create(c);for(var k={},g=0,l=e.length;g<l;g++){var m;if(e[g].data){m=0;for(var r=e[g].data.length;m<r;m++)k[e[g].data[m]]=a.utils.getAttribute(c.elm,"data-"+e[g].data[m])}else e[g].attr&&
e[g].name?(m=a.utils.getByClass(c.elm,e[g].name,!0),k[e[g].name]=m?a.utils.getAttribute(m,e[g].attr):""):(m=a.utils.getByClass(c.elm,e[g],!0),k[e[g]]=m?m.innerHTML:"");m=void 0}return k};this.set=function(c,e){if(!h.create(c))for(var k in e)if(e.hasOwnProperty(k)){var g=e[k],l=void 0,m=void 0;a:{for(var m=0,r=a.valueNames.length;m<r;m++)if(a.valueNames[m].data)for(var t=a.valueNames[m].data,s=0,f=t.length;s<f;s++){if(t[s]===k){m={data:k};break a}}else{if(a.valueNames[m].attr&&a.valueNames[m].name&&
a.valueNames[m].name==k){m=a.valueNames[m];break a}if(a.valueNames[m]===k){m=k;break a}}m=void 0}m&&(m.data?c.elm.setAttribute("data-"+m.data,g):m.attr&&m.name?(l=a.utils.getByClass(c.elm,m.name,!0),l&&l.setAttribute(m.attr,g)):(l=a.utils.getByClass(c.elm,m,!0),l&&(l.innerHTML=g)))}};this.create=function(a){if(void 0!==a.elm)return!1;if(void 0===c)throw Error("The list need to have at list one item on init otherwise you'll have to add a template.");var b=c.cloneNode(!0);return b.removeAttribute("id"),
a.elm=b,h.set(a,a.values()),!0};this.remove=function(c){c.elm.parentNode===a.list&&a.list.removeChild(c.elm)};this.show=function(c){h.create(c);a.list.appendChild(c.elm)};this.hide=function(c){void 0!==c.elm&&c.elm.parentNode===a.list&&a.list.removeChild(c.elm)};this.clear=function(){if(a.list.hasChildNodes())for(;1<=a.list.childNodes.length;)a.list.removeChild(a.list.firstChild)};(c=h.getItemSource(a.item))&&(c=h.clearSourceItem(c,a.valueNames))};g.exports=function(b){return new a(b)}},function(g,
l){g.exports=function(a,b){var c=a.getAttribute&&a.getAttribute(b)||null;if(!c)for(var g=a.attributes.length,d=0;d<g;d++)void 0!==b[d]&&b[d].nodeName===b&&(c=b[d].nodeValue);return c}},function(g,l,a){function b(a){return 48<=a&&57>=a}function c(a,c){for(var g=(a+="").length,h=(c+="").length,l=0,t=0;l<g&&t<h;){var s=a.charCodeAt(l),f=c.charCodeAt(t);if(b(s)){if(!b(f))return s-f;for(;48===s&&++l<g;)s=a.charCodeAt(l);for(;48===f&&++t<h;)f=c.charCodeAt(t);f=l;for(s=t;f<g&&b(a.charCodeAt(f));)++f;for(;s<
h&&b(c.charCodeAt(s));)++s;var n=f-l-s+t;if(n)return n;for(;l<f;)if(n=a.charCodeAt(l++)-c.charCodeAt(t++))return n;l=f;t=s}else{if(s!==f)return s<e&&f<e&&-1!==d[s]&&-1!==d[f]?d[s]-d[f]:s-f;++l;++t}}return g-h}var h,d,e=0;c.caseInsensitive=c.i=function(a,b){return c((""+a).toLowerCase(),(""+b).toLowerCase())};Object.defineProperties(c,{alphabet:{get:function(){return h},set:function(a){h=a;d=[];a=0;if(h)for(;a<h.length;a++)d[h.charCodeAt(a)]=a;e=d.length;for(a=0;a<e;a++)void 0===d[a]&&(d[a]=-1)}}});
g.exports=c},function(g,l){g.exports=function(a,b,c){function g(a,c){var e=a/b.length,f=Math.abs(k-c);return d?e+f/d:f?1:e}var d=c.distance||100,e=c.threshold||0.4;if(b===a)return!0;if(32<b.length)return!1;var k=c.location||0;c=function(){var a,c={};for(a=0;a<b.length;a++)c[b.charAt(a)]=0;for(a=0;a<b.length;a++)c[b.charAt(a)]|=1<<b.length-a-1;return c}();var l=a.indexOf(b,k);-1!=l&&(e=Math.min(g(0,l),e),l=a.lastIndexOf(b,k+b.length),-1!=l&&(e=Math.min(g(0,l),e)));for(var p=1<<b.length-1,l=-1,m,r,
t,s=b.length+a.length,f=0;f<b.length;f++){m=0;for(r=s;m<r;)g(f,k+r)<=e?m=r:s=r,r=Math.floor((s-m)/2+m);s=r;m=Math.max(1,k-r+1);var n=Math.min(k+r,a.length)+b.length;r=Array(n+2);for(r[n+1]=(1<<f)-1;n>=m;n--){var u=c[a.charAt(n-1)];if(0===f?r[n]=(r[n+1]<<1|1)&u:r[n]=(r[n+1]<<1|1)&u|((t[n+1]|t[n])<<1|1)|t[n+1],r[n]&p)if(u=g(f,n-1),u<=e){if(e=u,l=n-1,!(l>k))break;m=Math.max(1,2*k-l)}}if(g(f+1,k)>e)break;t=r}return!(0>l)}}]);define("nmodule/bmaps/rc/dist/list.min",function(){});
define("nmodule/bmaps/rc/BMapsWidget","baja! baja!baja:IStatus bajaux/Widget bajaux/mixin/subscriberMixIn jquery Promise underscore hbs!nmodule/bmaps/rc/BMapsWidgetTemplate hbs!nmodule/bmaps/rc/PopupTemplate lex!bmaps log!bmaps css!nmodule/bmaps/rc/BMapsWidgetStyle nmodule/bmaps/rc/dist/list.min".split(" "),function(g,l,a,b,c,h,d,e,k,q,p){function m(a){a=a.split(",");return{lng:parseFloat(1<a.length?a[0].trim():0),lat:parseFloat(1<a.length?a[1].trim():0)}}function r(a){return a.getType().is("baja:IStatus")&&
(a=g.Status.getStatusFromIStatus(a))&&a.isAlarm()?!0:!1}function t(a,b){function e(b){c(".list").hide();b=b.pos;b=new n.Point(b.lng,b.lat);a.properties().getValue("search3dAnimation")?(t.setTilt(50),b=[{center:b,zoom:18,percentage:0},{center:new n.Point(pp.lng,pp.lag),zoom:19,percentage:1}],b=new BMapGL.ViewAnimation(b,{}),b.addEventListener("animationstart",function(a){p.fine("start")}),b.addEventListener("animationiterations",function(a){p.fine("onanimationiterations")}),b.addEventListener("animationend",
function(a){p.fine("end")}),setTimeout(t.startViewAnimation(b),0)):t.centerAndZoom(b,18);C();v.attach("changed",A);p.fine("setplace")}function l(){return d.every(E,function(a){return!r(a)})}function q(){var a=l()?s:f;a!=D.getIcon().imageUrl&&(p.fine("update icon"),a=new n.Icon(a,new n.Size(12,20)),D.setIcon(a))}var n=a.$bmaps,t=a.$map,B=m(b.get(g.ComponentTags.idToSlotName("n:geoCoord"))),H=new n.Point(B.lng,B.lat),z=a.properties().getValue("titleTag"),z=b.get(g.ComponentTags.idToSlotName(z))||b.getDisplayName(),
J=new n.Icon(f,new n.Size(12,20)),D=new n.Marker(H,{icon:J,title:z}),w=new n.InfoWindow,C,v=new g.Subscriber,E,A,F=a.properties().getValue("alwaysSubscribeAllPoints");w.setTitle(z);t.addOverlay(D);a.searchList.add({title:z,pos:B});var I={title:z,pos:B,infoWindow:w};a.points.push(I);a.searchList.list.lastElementChild.addEventListener("click",function(a){e(I)});(function(){return new h(function(c,d){b.relations().then(function(c){c=c.getAll().filter(function(b){return b.getId().toString()===a.properties().getValue("childRelation")}).map(function(a){return a.getEndpointOrd()});
return(new g.BatchResolve(c)).resolve({base:b,subscriber:v})}).then(function(a){E=a.getTargetObjects();c()}).catch(function(a){p.fine("failed: fetchChildren: "+a);d()})})})().then(function(){q();F&&v.attach("changed",d.debounce(q,200))}).catch(function(a){p.fine("failed: update icon "+a)});C=function(){p.info("updating info window");var c={ord:b.getNavOrd().relativizeToSession().toString(),displayName:b.getDisplay("title")||b.getDisplayName(),rows:[],alarmCount:0};d.each(E,function(a){var b={displayName:a.getDisplayName(),
value:"no data"};r(a)&&(c.alarmCount+=1,b.alarm=!0);if(a=a.getValueOf("out"))b.value=a.getValue();c.rows.push(b)});var e=[a.properties().getValue("descriptionTag"),a.properties().getValue("imageSrcTag")];b.getSlots().each(function(a){var d=b.getDisplayName(a);e.includes(d)&&(c[d.split(":")[1]]=b.getDisplay(a))});b.getSlots().flags(g.Flags.SUMMARY).each(function(a){c.rows.push({displayName:b.getDisplayName(a),value:b.getDisplay(a)||b.get(a)})});w.setContent(k(c));w.isOpen()?w.redraw():t.openInfoWindow(w,
H)};A=d.debounce(C,500);D.addEventListener("click",function(){C();v.attach("changed",A)});w.addEventListener("close",function(){v.detach("changed",A);F||v.unsubscribeAll()});w.addEventListener("clickclose",function(){v.detach("changed",A);F||v.unsubscribeAll()})}var s="/module/bmaps/rc/ok.png",f="/module/bmaps/rc/alarm.gif",n=q[0];l=function(){a.apply(this,arguments);this.properties().add("ak","your-ak").add("position","116.404,39.915").add("titleTag","m:title").add("descriptionTag","m:description").add("imageSrcTag",
"m:imageSrc").add({name:"zoom",value:15,typeSpec:"baja:Integer"}).add("footprint",!1).add({name:"show3D",value:!0,typeSpec:"baja:Boolean",metadata:{trueText:n.get("show3d"),falseText:n.get("hide3d")}}).add("icon","").add("childRelation","m:child").add("alwaysSubscribeAllPoints",!0);b(this)};l.prototype=new a;l.prototype.constructor=l;l.prototype.doInitialize=function(a){var b=this;p.info("BMapsWidget initializing");a.addClass("bMapsWidget");a.html(e({}));var d="https://api.map.baidu.com/api?v\x3d3.0\x26ak\x3d"+
b.properties().getValue("ak"),f="https://api.map.baidu.com/api?type\x3dwebgl\x26v\x3d1.0\x26ak\x3d"+b.properties().getValue("ak");return new h(function(e,g){require(["async!"+d,"async!"+f],function(){p.info("Baidu Map API initialized");b.points=[];b.$bmaps=BMapGL;b.$map=new b.$bmaps.Map(a.find("div#container").get(0));var d=m(b.properties().getValue("position")),d=new b.$bmaps.Point(d.lng,d.lat);b.$map.centerAndZoom(d,b.properties().getValue("zoom"));b.$map.enableScrollWheelZoom(!0);b.$map.addControl(new b.$bmaps.ScaleControl);
b.$map.addControl(new b.$bmaps.MapTypeControl);b.$map.addControl(new b.$bmaps.ZoomControl);var f=b.properties().getValue("icon");f&&(f=new b.$bmaps.Icon(f,new b.$bmaps.Size(300,157)),d=new b.$bmaps.Marker(d,{icon:f}),b.$map.addOverlay(d));b.properties().getValue("footprint")&&b.$map.addEventListener("click",function(a){p.info("lng:{},lat:{}",a.point.lng,a.point.lat)});d=new List("search-list",{item:"search-item",valueNames:["title"]},b.points);b.searchList=d;d.on("updated",function(a){5<a.matchingItems.length?
c(".list").hide():a.searched&&c(".list").show()});document.getElementById("search-list").addEventListener("focusout",function(a){c(".list").hide()});e()})})};l.prototype.doLoad=function(a){var b=this;p.info("BMapsWidget loading");return a.cursor().then(function(a){var b=[];a.each(function(){b.push(this.get())});return b}).then(function(a){return h.all(d.map(a,function(a){return a.tags()}))}).then(function(a){a=d.filter(a,function(a){return a.contains("n:ordInSession")&&a.contains("n:geoCoord")});
a=d.map(a,function(a){return a.get("n:ordInSession")});return(new g.BatchResolve(a)).resolve({subscriber:b.getSubscriber()})}).then(function(a){a=a.getTargetObjects();d.each(a,function(a){t(b,a)})})};l.prototype.doDestroy=function(){this.jq().removeClass("bMapsWidget")};return l});