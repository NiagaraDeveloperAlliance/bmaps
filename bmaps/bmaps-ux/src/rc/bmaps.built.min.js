define("hbs!nmodule/bmaps/rc/BMapsWidgetTemplate",["Handlebars"],function(k){var e=k.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(h,a,g,e,f){return'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\x3chead\x3e\n    \x3cmeta http-equiv\x3d"Content-Type" content\x3d"text/html; charset\x3dutf-8"/\x3e\n    \x3cmeta name\x3d"viewport" content\x3d"initial-scale\x3d1.0, user-scalable\x3dno"/\x3e\n    \x3cstyle type\x3d"text/css"\x3e\n        body, html, #container {\n            width: 100%;\n            height: 100%;\n            overflow: hidden;\n            margin: 0;\n            font-family: "\u5fae\u8f6f\u96c5\u9ed1";\n        }\n    \x3c/style\x3e\n    \x3ctitle\x3e\u5730\u56fe\u5c55\u793a\x3c/title\x3e\n\x3c/head\x3e\n\x3cbody\x3e\n\x3cdiv id\x3d"container"\x3e\x3c/div\x3e\n\x3c/body\x3e\n\x3c/html\x3e\n'},
useData:!0});k.registerPartial("nmodule/bmaps/rc/BMapsWidgetTemplate",e);return e});
define("hbs!nmodule/bmaps/rc/PopupTemplate",["Handlebars"],function(k){var e=k.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(h,a,g,e,f){var c,b;return"\x3ca target\x3d'new' href\x3d'javascript:window.top.niagara.env.hyperlink(\""+h.escapeExpression((b=null!=(b=g.ord||(null!=a?a.ord:a))?b:g.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"ord",hash:{},data:f}):b))+"\");'\x3e"+h.escapeExpression((b=null!=(b=g.displayName||(null!=a?a.displayName:a))?b:g.helperMissing,"function"===
typeof b?b.call(null!=a?a:{},{name:"displayName",hash:{},data:f}):b))+"\x3c/a\x3e\n\x3cbr /\x3e\n\x3cbr /\x3e\n\x3ctable border\x3d'1'\x3e\n  \x3ctr\x3e\n    \x3cth\x3e"+h.escapeExpression((b=null!=(b=g.name||(null!=a?a.name:a))?b:g.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"name",hash:{},data:f}):b))+"\x3c/th\x3e\n    \x3cth\x3e"+h.escapeExpression((b=null!=(b=g.display||(null!=a?a.display:a))?b:g.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"display",hash:{},
data:f}):b))+"\x3c/th\x3e\n  \x3c/tr\x3e  \n"+(null!=(c=g["if"].call(null!=a?a:{},null!=a?a.rows:a,{name:"if",hash:{},fn:h.program(1,f,0),inverse:h.noop,data:f}))?c:"")+"\x3c/table\x3e\n\x3cbr /\x3e\n\x3cbr /\x3e\n"},1:function(e,a,g,k,f){var c;return null!=(c=g.each.call(null!=a?a:{},null!=a?a.rows:a,{name:"each",hash:{},fn:e.program(2,f,0),inverse:e.noop,data:f}))?c:""},2:function(e,a,g,k,f){var c;return"    \x3ctr\x3e\n      \x3ctd\x3e"+e.escapeExpression((c=null!=(c=g.displayName||(null!=a?a.displayName:
a))?c:g.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"displayName",hash:{},data:f}):c))+"\x3c/td\x3e\n      \x3ctd\x3e"+e.escapeExpression((c=null!=(c=g.value||(null!=a?a.value:a))?c:g.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"value",hash:{},data:f}):c))+"\x3c/td\x3e\n    \x3c/tr\x3e\n"},useData:!0});k.registerPartial("nmodule/bmaps/rc/PopupTemplate",e);return e});
define("nmodule/bmaps/rc/BMapsWidget","baja! baja!baja:IStatus bajaux/Widget bajaux/mixin/subscriberMixIn jquery Promise underscore hbs!nmodule/bmaps/rc/BMapsWidgetTemplate hbs!nmodule/bmaps/rc/PopupTemplate lex!bmaps log!bmaps css!nmodule/bmaps/rc/BMapsWidgetStyle".split(" "),function(k,e,h,a,g,p,f,c,b,t,n){function q(a){a=a.split(",");return{lng:parseFloat(1<a.length?a[0].trim():0),lat:parseFloat(1<a.length?a[1].trim():0)}}function r(a){return a.getType().is("baja:IStatus")&&(a=k.Status.getStatusFromIStatus(a))&&
a.isAlarm()?u:v}function w(a,d){var l=a.$bmaps,e=a.$map,c=q(d.get(k.ComponentTags.idToSlotName("n:geoCoord"))),g=new l.Point(c.lng,c.lat),c=new l.Icon(r(d),new l.Size(12,20)),f=new l.Marker(g,{icon:c,title:d.getDisplayName()}),h=new l.InfoWindow,m;e.addOverlay(f);a.getSubscriber().attach("changed",function(){if(this===d){var a=new l.Icon(r(d),new l.Size(12,20));f.setIcon(a)}});f.addEventListener("click",function(){m=function(){if(this===d){var a={ord:d.getNavOrd().relativizeToSession().toString(),
displayName:d.getDisplayName(),name:s.get("name"),display:s.get("display")};d.getSlots().flags(k.Flags.SUMMARY).each(function(b){a.rows=a.rows||[];a.rows.push({displayName:d.getDisplayName(b),value:d.getDisplay(b)||d.get(b)})});h.setContent(b(a))}};m.call(d);e.openInfoWindow(h,g);a.getSubscriber().attach("changed",m)});h.addEventListener("close",function(){a.getSubscriber().detach("changed",m)});h.addEventListener("clickclose",function(){a.getSubscriber().detach("changed",m)})}var v="/module/bmaps/rc/ok.png",
u="/module/bmaps/rc/alarm.gif",s=t[0];e=function(){h.apply(this,arguments);this.properties().add("ak","Baidu Map -\x3e ak").add("position","116.404,39.915").add({name:"zoom",value:15,typeSpec:"baja:Integer"}).add("footprint",!1).add("icon","");a(this)};e.prototype=new h;e.prototype.constructor=e;e.prototype.doInitialize=function(a){var d=this;n.fine("BMapsWidget initializing");a.addClass("bMapsWidget");a.html(c({}));var b="https://api.map.baidu.com/api?v\x3d3.0\x26ak\x3d"+d.properties().getValue("ak");
return new p(function(e,c){require(["async!"+b],function(){e();n.fine("Baidu Map API initialized");d.$bmaps=BMap;d.$map=new d.$bmaps.Map(a.find("div#container").get(0));var b=q(d.properties().getValue("position")),b=new d.$bmaps.Point(b.lng,b.lat);d.$map.centerAndZoom(b,d.properties().getValue("zoom"));var c=d.properties().getValue("icon");c&&(c=new d.$bmaps.Icon(c,new d.$bmaps.Size(300,157)),b=new d.$bmaps.Marker(b,{icon:c}),d.$map.addOverlay(b));d.properties().getValue("footprint")&&d.$map.addEventListener("click",
function(a){n.info("lng:{},lat:{}",a.point.lng,a.point.lat)})})})};e.prototype.doLoad=function(a){var b=this;n.fine("BMapsWidget loading");return a.cursor().then(function(a){var b=[];a.each(function(){b.push(this.get())});return b}).then(function(a){return p.all(f.map(a,function(a){return a.tags()}))}).then(function(a){a=f.filter(a,function(a){return a.contains("n:ordInSession")&&a.contains("n:geoCoord")});a=f.map(a,function(a){return a.get("n:ordInSession")});return(new k.BatchResolve(a)).resolve({subscriber:b.getSubscriber()})}).then(function(a){a=
a.getTargetObjects();f.each(a,function(a){w(b,a)})})};e.prototype.doDestroy=function(){this.jq().removeClass("bMapsWidget")};return e});